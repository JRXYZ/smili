

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example script of imaging using L-BFGS-B optimizer &mdash; Smili 0.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'0.0.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Smili
          

          
          </a>

          
            
            
              <div class="version">
                0.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../_static/install.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">2. Tutorial and Example Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_static/license.html">3. License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_static/references.html">4. References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_static/link.html">5. Developer Team and Related Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_static/acknowledgement.html">6. Acknowledgement</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Smili</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Example script of imaging using L-BFGS-B optimizer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/_examples/imaging/imaging_lbfgs.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Example-script-of-imaging-using-L-BFGS-B-optimizer">
<h1>Example script of imaging using L-BFGS-B optimizer<a class="headerlink" href="#Example-script-of-imaging-using-L-BFGS-B-optimizer" title="Permalink to this headline">¶</a></h1>
<p>SMILI have several imaging functions, but the most general one is a static imaging (no dynamical/no multi-frequency) function using L-BFGS-B. This notebook describes a tutorial and introducition to SMILI’s imaging function with L-BFGS-B.</p>
<p>In this notebook, we wil use a <a class="reference external" href="3C273DEC16.UVP">VLBA 43 GHz data set</a> observed by <a class="reference external" href="https://www.bu.edu/blazars/VLBAproject.html">the Boston University Blazar Group</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">smili</span> <span class="kn">import</span> <span class="n">uvdata</span><span class="p">,</span><span class="n">imdata</span><span class="p">,</span><span class="n">imaging</span><span class="p">,</span><span class="n">util</span>
</pre></div>
</div>
</div>
<p>First, you need to load the uvfits data into <strong>uvdata.UVFITS</strong> object.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">uvfits</span> <span class="o">=</span> <span class="n">uvdata</span><span class="o">.</span><span class="n">UVFITS</span><span class="p">(</span><span class="s2">&quot;./3C273DEC16.UVP&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Filename: ./3C273DEC16.UVP
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 GroupsHDU      155   (3, 4, 1, 4, 1, 1)   float32   1913 Groups  7 Parameters
  1  AIPS NX       1 BinTableHDU     31   8R x 7C   [1E, 1E, 1J, 1J, 1J, 1J, 1J]
  2  AIPS FQ       1 BinTableHDU     29   1R x 6C   [1J, 4D, 4E, 4E, 4J, 32A]
  3  AIPS AN       1 BinTableHDU     72   10R x 14C   [8A, 3D, 0D, 1J, 1J, 1E, 1E, 4E, 1A, 1E, 8E, 1A, 1E, 8E]

Loading HDUs in the input UVFITS files.
  Primary HDU was loaded.
  AIPS FQ Table was loaded.
  Subarray 1 was found in an AIPS AN table

Checking loaded HDUs.
  1 Subarray settings are found.
  No AIPS SU tables were found.
    Assuming that this is a single source UVFITS file.

Reading FQ Tables
  Frequency Setup ID: 1
    IF Freq setups (Hz):
         if_freq_offset  ch_bandwidth  if_bandwidth  sideband
      0             0.0    64000000.0    64000000.0         1
      1      80000000.0    64000000.0    64000000.0         1
      2     144000000.0    64000000.0    64000000.0         1
      3     208000000.0    64000000.0    64000000.0         1
    Note: Central Frequency of ch=i at IF=j (where i,j=1,2,3...)
       freq(i,j) = reffreq + (i-1) * ch_bandwidth(j) * sideband + if_freq_offset(j)

Reading AN Tables
  Sub Array ID: 1
    Frequency Setup ID: 1
    Reference Frequency: 43007500000 Hz
    Reference Date: 2016-12-
    AN Table Contents:
         id      name             x             y             z  mnttype
      0   1  BR       -2.112065e+06 -3.705357e+06  4.726814e+06        0
      1   2  FD       -1.324009e+06 -5.332182e+06  3.231962e+06        0
      2   3  HN        1.446375e+06 -4.447940e+06  4.322306e+06        0
      3   4  KP       -1.995679e+06 -5.037318e+06  3.357328e+06        0
      4   5  LA       -1.449753e+06 -4.975299e+06  3.709124e+06        0
      5   6  MK       -5.464075e+06 -2.495248e+06  2.148297e+06        0
      6   7  NL       -1.308726e+05 -4.762317e+06  4.226851e+06        0
      7   8  OV       -2.409150e+06 -4.478573e+06  3.838617e+06        0
      8   9  PT       -1.640954e+06 -5.014816e+06  3.575412e+06        0
      9  10  SC        2.607849e+06 -5.488069e+06  1.932740e+06        0

Reading Source Information from Primary HDU
  Frequency Setup ID: 1
    Sources:
         id source                           radec  equinox
      0   1  3C273  12h29m06.6997s +02d03m08.5983s   2000.0

Reading Primary HDU data
  VisData.sort: 0 indexes have wrong station orders (ant1 &gt; ant2).
  VisData.sort: Data have been sorted by utc, ant1, ant2, subarray
</pre></div></div>
</div>
<p>As you can see the above log, this data set has full Stokes parameters. A simple way to make Stokes I image is computing Stokes I visibilities using UVFITS.select_stokes method.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">uvfits_I</span> <span class="o">=</span> <span class="n">uvfits</span><span class="o">.</span><span class="n">select_stokes</span><span class="p">(</span><span class="n">stokes</span><span class="o">=</span><span class="s2">&quot;I&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Stokes I data will be calculated from input RR and LL data
</pre></div></div>
</div>
<p>For imaging, SMILI use two dimensional data tables using classes inheriting <strong>pandas.DataFrame</strong>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create a table of full complex visibilities</span>
<span class="n">vistable</span> <span class="o">=</span> <span class="n">uvfits_I</span><span class="o">.</span><span class="n">make_vistable</span><span class="p">()</span>

<span class="c1"># Create a table of bi-spectra (default: only independent closure quantities)</span>
<span class="n">bstable</span> <span class="o">=</span> <span class="n">vistable</span><span class="o">.</span><span class="n">make_bstable</span><span class="p">()</span>
<span class="c1">#bstable = vistable.make_bstable(redundant=[[&quot;AA&quot;, &quot;AP&quot;],[&quot;SM&quot;,&quot;JC&quot;,&quot;SR&quot;]]) # if you have redundant sites and want to omit trivial closures</span>
<span class="c1">#bstable = vistable.make_bstable(dependent=True)</span>

<span class="c1"># Create a table of closure amplitudes</span>
<span class="n">catable</span> <span class="o">=</span> <span class="n">vistable</span><span class="o">.</span><span class="n">make_catable</span><span class="p">()</span>
<span class="c1">#catable = vistable.make_catable(redundant=[[&quot;AA&quot;, &quot;AP&quot;],[&quot;SM&quot;,&quot;JC&quot;,&quot;SR&quot;]]) # if you have redundant sites and want to omit trivial closures</span>
<span class="c1">#catable = vistable.make_catable(dependent=True)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
  2%|▏         | 124/7647 [00:00&lt;00:06, 1231.82it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1/5) Sort data
(2/5) Tagging data
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 7647/7647 [00:05&lt;00:00, 1348.74it/s]
 11%|█         | 27/248 [00:00&lt;00:01, 211.73it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  Number of Tags: 248
(3/5) Checking Baseline Combinations
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 248/248 [00:00&lt;00:00, 444.12it/s]
  0%|          | 1/248 [00:00&lt;00:31,  7.90it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  Detect 25 combinations for Closure Phases
(4/5) Forming Closure Phases
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 248/248 [00:26&lt;00:00,  9.33it/s]
  2%|▏         | 139/7647 [00:00&lt;00:05, 1376.65it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(5/5) Creating BSTable object
(1/5) Sort data
(2/5) Tagging data
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 7647/7647 [00:05&lt;00:00, 1304.78it/s]
  0%|          | 0/248 [00:00&lt;?, ?it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  Number of Tags: 248
(3/5) Checking Baseline Combinations
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 248/248 [00:00&lt;00:00, 260.02it/s]
  0%|          | 1/248 [00:00&lt;00:39,  6.19it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  Detect 25 combinations for Closure Amplitudes
(4/5) Forming Closure Amplitudes
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 248/248 [00:34&lt;00:00,  7.14it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(5/5) Creating CATable object
</pre></div></div>
</div>
<p>You can save these tables with .to_csv() methods in a similar way to pandas.DataFrame</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">vistable</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;vistable.csv&quot;</span><span class="p">)</span>
<span class="n">bstable</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;bstable.csv&quot;</span><span class="p">)</span>
<span class="n">catable</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;catable.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>You can read these tables with <strong>uvdata.read_XXtable</strong> functions. You probably don’t need to recompute closure quanties onece they are formulated, so this save &amp; load process can save your time for full closure imaging.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">vistable</span> <span class="o">=</span> <span class="n">uvdata</span><span class="o">.</span><span class="n">read_vistable</span><span class="p">(</span><span class="s2">&quot;vistable.csv&quot;</span><span class="p">)</span>
<span class="n">bstable</span> <span class="o">=</span> <span class="n">uvdata</span><span class="o">.</span><span class="n">read_bstable</span><span class="p">(</span><span class="s2">&quot;bstable.csv&quot;</span><span class="p">)</span>
<span class="n">catable</span> <span class="o">=</span> <span class="n">uvdata</span><span class="o">.</span><span class="n">read_catable</span><span class="p">(</span><span class="s2">&quot;catable.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">util</span><span class="o">.</span><span class="n">matplotlibrc</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">vistable</span><span class="o">.</span><span class="n">radplot</span><span class="p">(</span><span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;imag&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">util</span><span class="o">.</span><span class="n">matplotlibrc</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">vistable</span><span class="o">.</span><span class="n">tplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">util</span><span class="o">.</span><span class="n">matplotlibrc</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">vistable</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">()</span> <span class="c1"># List of baselines</span>
<span class="n">vistable</span><span class="o">.</span><span class="n">station_dic</span><span class="p">(</span><span class="n">id2name</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="c1"># dictionary connecting ID number and name</span>
<span class="n">vistable</span><span class="o">.</span><span class="n">station_list</span><span class="p">()</span> <span class="c1"># List of stations</span>
<span class="n">vistable</span><span class="o">.</span><span class="n">vplot</span><span class="p">(</span><span class="n">baseline</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;BR&quot;</span><span class="p">,</span><span class="s2">&quot;FD&quot;</span><span class="p">],</span> <span class="n">axis1</span><span class="o">=</span><span class="s2">&quot;utc&quot;</span><span class="p">,</span> <span class="n">axis2</span><span class="o">=</span><span class="s2">&quot;vreal&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="2.-Full-Closure-Imaging">
<h2>2. Full Closure Imaging<a class="headerlink" href="#2.-Full-Closure-Imaging" title="Permalink to this headline">¶</a></h2>
<p>Here, we would try a simple imaging with full closure quantities and also error-increased amplitude data sets. Full closure imaging is non-convex optimization, so therefore the resultant image will be affected by a choise of the initial image. In particular, you need non-zero (not empty image) for closure imaging, since closure imaging do not have sensitivities in the absolute position and needs a reference for a relative position.</p>
<p>Here, we can start from a circular Gaussian, of which beam size is corresponding to the minor beam size of the synthesized beam. You can estimate beam size parameters from vistable.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">beamprm</span> <span class="o">=</span> <span class="n">vistable</span><span class="o">.</span><span class="n">fit_beam</span><span class="p">(</span><span class="n">angunit</span><span class="o">=</span><span class="s2">&quot;mas&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">beamprm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{u&#39;minsize&#39;: 0.11969941024814679, u&#39;pa&#39;: -15.60577507084539, u&#39;majsize&#39;: 0.6946287189501326, u&#39;angunit&#39;: &#39;mas&#39;}
</pre></div></div>
</div>
<p>For starting imaging, we need to define the image FOV, pixel size. SMILI will do it by setting the initial image.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># This command can create an empty image. The final option uvfitsfile is optional, and can read header informations from uvfits file.</span>
<span class="n">initimage</span> <span class="o">=</span> <span class="n">imdata</span><span class="o">.</span><span class="n">IMFITS</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">nxref</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">nyref</span><span class="o">=</span><span class="mi">216</span><span class="p">,</span> <span class="n">angunit</span><span class="o">=</span><span class="s2">&quot;mas&quot;</span><span class="p">,</span> <span class="n">uvfitsfile</span><span class="o">=</span><span class="s2">&quot;3C273DEC16.UVP&quot;</span><span class="p">)</span>

<span class="c1"># set beam</span>
<span class="n">initimage</span><span class="o">.</span><span class="n">set_beam</span><span class="p">(</span><span class="o">**</span><span class="n">beamprm</span><span class="p">)</span>

<span class="c1"># add a Gaussian</span>
<span class="n">beamprm</span><span class="p">[</span><span class="s2">&quot;majsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beamprm</span><span class="p">[</span><span class="s2">&quot;minsize&quot;</span><span class="p">]</span>
<span class="n">initimage</span> <span class="o">=</span> <span class="n">initimage</span><span class="o">.</span><span class="n">add_gauss</span><span class="p">(</span><span class="n">totalflux</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">beamprm</span><span class="p">)</span> <span class="c1"># this can add a circular or elliptical gaussian to the image</span>

<span class="c1"># show imagee</span>
<span class="n">initimage</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">dyrange</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">fluxunit</span><span class="o">=</span><span class="s2">&quot;mJy&quot;</span><span class="p">,</span> <span class="n">saunit</span><span class="o">=</span><span class="s2">&quot;pixel&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(&lt;matplotlib.image.AxesImage at 0x1c2d945d10&gt;,
 &lt;matplotlib.colorbar.Colorbar at 0x1c2d87f2d0&gt;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_examples_imaging_imaging_lbfgs_20_1.png" src="../../_images/_examples_imaging_imaging_lbfgs_20_1.png" />
</div>
</div>
<p>In interferometric imaging, limiting imaging region genrally works as a really nice prior if we have a reliable prior information for the source structure. SMILI has a function to set such a region with <strong>imdata.IMRegion</strong> object. To make a region table more flexiblly, please have a look at the instruction of IMRegion.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">imregion</span> <span class="o">=</span> <span class="n">imdata</span><span class="o">.</span><span class="n">IMRegion</span><span class="p">()</span>
<span class="n">imregion</span> <span class="o">=</span> <span class="n">imregion</span><span class="o">.</span><span class="n">add_box</span><span class="p">(</span><span class="n">xc</span><span class="o">=-</span><span class="mf">2.0</span><span class="p">,</span><span class="n">yc</span><span class="o">=-</span><span class="mf">2.0</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">7.0</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span><span class="n">angle</span><span class="o">=-</span><span class="mi">45</span><span class="p">,</span><span class="n">angunit</span><span class="o">=</span><span class="s2">&quot;mas&quot;</span><span class="p">)</span>

<span class="n">imregion</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">angunit</span><span class="o">=</span><span class="s2">&quot;mas&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
<span class="n">initimage</span><span class="o">.</span><span class="n">imshow</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.image.AxesImage at 0x1c2d642f10&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_examples_imaging_imaging_lbfgs_22_1.png" src="../../_images/_examples_imaging_imaging_lbfgs_22_1.png" />
</div>
</div>
<p>Before starting imaging, let’s make a table for visibility amplitudes. Since they could have residual gain errors, let’s add additional errors for residual errrors. We can copy tables for full complex visibilities and add potential systematic errors.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">syserr</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">amptable</span> <span class="o">=</span> <span class="n">vistable</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">amptable</span> <span class="o">=</span> <span class="n">amptable</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="n">amptable</span><span class="p">[</span><span class="s2">&quot;amp&quot;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Then, now is the time to make the first image! The simplest imaging function is imaging.lbfgs.imaging.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">imprm</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;amptable&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">amptable</span> <span class="c1"># use amplitudes</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;bstable&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">bstable</span> <span class="c1"># use closure phases</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;catable&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">catable</span> <span class="c1"># use closure amplitudes</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;lambl1&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;lambtsv&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.1</span>
<span class="c1"># Total flux regularization</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;fluxconst&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;totalflux&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">12</span>
<span class="c1"># Cent-of-mass regularization</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;lambcom&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;compower&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">5.0</span> <span class="c1"># the power of the centroid. 1 gives the regularization using the exact center of the mass. The higher value gives regularization using the region close to the peak of the image.</span>
<span class="c1"># iteration number</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;niter&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">1000</span>
<span class="c1"># imaging window</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;imregion&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">imregion</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">outimage</span> <span class="o">=</span> <span class="n">imaging</span><span class="o">.</span><span class="n">lbfgs</span><span class="o">.</span><span class="n">imaging</span><span class="p">(</span><span class="n">initimage</span><span class="p">,</span><span class="o">**</span><span class="n">imprm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imaging Window: Specified. Images will be solved on specified pixels.
Total Flux Constraint: set to 12
</pre></div></div>
</div>
<p>You can check howthe image is.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">outimage</span><span class="o">.</span><span class="n">convolve_gauss</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="o">**</span><span class="n">beamprm</span><span class="p">)</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span><span class="n">dyrange</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">saunit</span><span class="o">=</span><span class="s2">&quot;beam&quot;</span><span class="p">,</span><span class="n">colorbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(&lt;matplotlib.image.AxesImage at 0x1c2ddf4890&gt;,
 &lt;matplotlib.colorbar.Colorbar at 0x1c2df48e10&gt;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_examples_imaging_imaging_lbfgs_29_1.png" src="../../_images/_examples_imaging_imaging_lbfgs_29_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">outimage</span><span class="o">.</span><span class="n">to_fits</span><span class="p">(</span><span class="s2">&quot;3C273_image.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>You can also see the statistical quantities (chisquares, reduced chisquares) with imaging.lbfgs.statistics</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">imaging</span><span class="o">.</span><span class="n">lbfgs</span><span class="o">.</span><span class="n">statistics</span><span class="p">(</span><span class="n">outimage</span><span class="p">,</span> <span class="o">**</span><span class="n">imprm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imaging Window: Specified. Images will be calcurated on specified pixels.
Imaging Window: Specified. Images will be calcurated on specified pixels.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>OrderedDict([(&#39;cost&#39;, 2.1360701791818633),
             (&#39;chisq&#39;, 6419.326044676482),
             (&#39;rchisq&#39;, 0.9705663811122591),
             (&#39;isfcv&#39;, False),
             (&#39;isamp&#39;, True),
             (&#39;iscp&#39;, True),
             (&#39;isca&#39;, True),
             (&#39;chisqfcv&#39;, 0.0),
             (&#39;chisqamp&#39;, 630.5967708658529),
             (&#39;chisqcp&#39;, 3574.6063971267276),
             (&#39;chisqca&#39;, 2214.122876683901),
             (&#39;rchisqfcv&#39;, 0.0),
             (&#39;rchisqamp&#39;, 0.2379610456097558),
             (&#39;rchisqcp&#39;, 1.7643664349095398),
             (&#39;rchisqca&#39;, 1.1424782645427765),
             (&#39;lambl1&#39;, 1),
             (&#39;lambl1_sim&#39;, 0.08333333333333333),
             (&#39;l1&#39;, 12.511645447600353),
             (&#39;l1cost&#39;, 1.0426371206333627),
             (&#39;lambtv&#39;, 0.0),
             (&#39;lambtv_sim&#39;, 0.0),
             (&#39;tv&#39;, 5.040902667636085),
             (&#39;tvcost&#39;, 0.0),
             (&#39;lambtsv&#39;, 0.1),
             (&#39;lambtsv_sim&#39;, 11.377777777777778),
             (&#39;tsv&#39;, 0.010798829071544681),
             (&#39;tsvcost&#39;, 0.1228666774362417)])
</pre></div>
</div>
</div>
<p>You can make a summary plot.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">imaging</span><span class="o">.</span><span class="n">lbfgs</span><span class="o">.</span><span class="n">plots</span><span class="p">(</span><span class="n">outimage</span><span class="p">,</span><span class="n">imprm</span><span class="p">)</span>
<span class="n">imaging</span><span class="o">.</span><span class="n">lbfgs</span><span class="o">.</span><span class="n">plots</span><span class="p">(</span><span class="n">outimage</span><span class="p">,</span><span class="n">imprm</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;out1.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/akiyama/anaconda/lib/python2.7/site-packages/smili-0.0.1-py2.7.egg/smili/imaging/lbfgs.py:586: UserWarning:
This call to matplotlib.use() has no effect because the backend has already
been chosen; matplotlib.use() must be called *before* pylab, matplotlib.pyplot,
or matplotlib.backends is imported for the first time.

The backend was *originally* set to &#39;module://ipykernel.pylab.backend_inline&#39; by the following code:
  File &#34;/Users/akiyama/anaconda/lib/python2.7/runpy.py&#34;, line 174, in _run_module_as_main
    &#34;__main__&#34;, fname, loader, pkg_name)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/runpy.py&#34;, line 72, in _run_code
    exec code in run_globals
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel_launcher.py&#34;, line 16, in &lt;module&gt;
    app.launch_new_instance()
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/traitlets/config/application.py&#34;, line 658, in launch_instance
    app.start()
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/kernelapp.py&#34;, line 486, in start
    self.io_loop.start()
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/tornado/ioloop.py&#34;, line 1064, in start
    handler_func(fd_obj, events)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/tornado/stack_context.py&#34;, line 276, in null_wrapper
    return fn(*args, **kwargs)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py&#34;, line 450, in _handle_events
    self._handle_recv()
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py&#34;, line 480, in _handle_recv
    self._run_callback(callback, msg)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py&#34;, line 432, in _run_callback
    callback(*args, **kwargs)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/tornado/stack_context.py&#34;, line 276, in null_wrapper
    return fn(*args, **kwargs)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/kernelbase.py&#34;, line 283, in dispatcher
    return self.dispatch_shell(stream, msg)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/kernelbase.py&#34;, line 233, in dispatch_shell
    handler(stream, idents, msg)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/kernelbase.py&#34;, line 399, in execute_request
    user_expressions, allow_stdin)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/ipkernel.py&#34;, line 208, in do_execute
    res = shell.run_cell(code, store_history=store_history, silent=silent)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/zmqshell.py&#34;, line 537, in run_cell
    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/IPython/core/interactiveshell.py&#34;, line 2724, in run_cell
    self.events.trigger(&#39;post_run_cell&#39;)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/IPython/core/events.py&#34;, line 74, in trigger
    func(*args, **kwargs)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/pylab/backend_inline.py&#34;, line 160, in configure_once
    activate_matplotlib(backend)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/IPython/core/pylabtools.py&#34;, line 315, in activate_matplotlib
    matplotlib.pyplot.switch_backend(backend)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/matplotlib/pyplot.py&#34;, line 231, in switch_backend
    matplotlib.use(newbackend, warn=False, force=True)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/matplotlib/__init__.py&#34;, line 1410, in use
    reload(sys.modules[&#39;matplotlib.backends&#39;])
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/matplotlib/backends/__init__.py&#34;, line 16, in &lt;module&gt;
    line for line in traceback.format_stack()


  matplotlib.use(&#39;Agg&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imaging Window: Specified. Images will be calcurated on specified pixels.
Imaging Window: Specified. Images will be calcurated on specified pixels.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/akiyama/anaconda/lib/python2.7/site-packages/matplotlib/axes/_axes.py:6462: UserWarning: The &#39;normed&#39; kwarg is deprecated, and has been replaced by the &#39;density&#39; kwarg.
  warnings.warn(&#34;The &#39;normed&#39; kwarg is deprecated, and has been &#34;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imaging Window: Not Specified. We calcurate the image on all the pixels.
Imaging Window: Not Specified. We calcurate the image on all the pixels.
Imaging Window: Not Specified. We calcurate the image on all the pixels.
Imaging Window: Not Specified. We calcurate the image on all the pixels.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_examples_imaging_imaging_lbfgs_34_4.png" src="../../_images/_examples_imaging_imaging_lbfgs_34_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_examples_imaging_imaging_lbfgs_34_5.png" src="../../_images/_examples_imaging_imaging_lbfgs_34_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_examples_imaging_imaging_lbfgs_34_6.png" src="../../_images/_examples_imaging_imaging_lbfgs_34_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_examples_imaging_imaging_lbfgs_34_7.png" src="../../_images/_examples_imaging_imaging_lbfgs_34_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/akiyama/anaconda/lib/python2.7/site-packages/smili-0.0.1-py2.7.egg/smili/imaging/lbfgs.py:889: UserWarning:
This call to matplotlib.use() has no effect because the backend has already
been chosen; matplotlib.use() must be called *before* pylab, matplotlib.pyplot,
or matplotlib.backends is imported for the first time.

The backend was *originally* set to &#39;agg&#39; by the following code:
  File &#34;/Users/akiyama/anaconda/lib/python2.7/runpy.py&#34;, line 174, in _run_module_as_main
    &#34;__main__&#34;, fname, loader, pkg_name)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/runpy.py&#34;, line 72, in _run_code
    exec code in run_globals
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel_launcher.py&#34;, line 16, in &lt;module&gt;
    app.launch_new_instance()
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/traitlets/config/application.py&#34;, line 658, in launch_instance
    app.start()
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/kernelapp.py&#34;, line 486, in start
    self.io_loop.start()
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/tornado/ioloop.py&#34;, line 1064, in start
    handler_func(fd_obj, events)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/tornado/stack_context.py&#34;, line 276, in null_wrapper
    return fn(*args, **kwargs)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py&#34;, line 450, in _handle_events
    self._handle_recv()
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py&#34;, line 480, in _handle_recv
    self._run_callback(callback, msg)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/zmq/eventloop/zmqstream.py&#34;, line 432, in _run_callback
    callback(*args, **kwargs)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/tornado/stack_context.py&#34;, line 276, in null_wrapper
    return fn(*args, **kwargs)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/kernelbase.py&#34;, line 283, in dispatcher
    return self.dispatch_shell(stream, msg)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/kernelbase.py&#34;, line 233, in dispatch_shell
    handler(stream, idents, msg)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/kernelbase.py&#34;, line 399, in execute_request
    user_expressions, allow_stdin)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/ipkernel.py&#34;, line 208, in do_execute
    res = shell.run_cell(code, store_history=store_history, silent=silent)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/zmqshell.py&#34;, line 537, in run_cell
    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/IPython/core/interactiveshell.py&#34;, line 2724, in run_cell
    self.events.trigger(&#39;post_run_cell&#39;)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/IPython/core/events.py&#34;, line 74, in trigger
    func(*args, **kwargs)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/ipykernel/pylab/backend_inline.py&#34;, line 160, in configure_once
    activate_matplotlib(backend)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/IPython/core/pylabtools.py&#34;, line 315, in activate_matplotlib
    matplotlib.pyplot.switch_backend(backend)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/matplotlib/pyplot.py&#34;, line 231, in switch_backend
    matplotlib.use(newbackend, warn=False, force=True)
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/matplotlib/__init__.py&#34;, line 1410, in use
    reload(sys.modules[&#39;matplotlib.backends&#39;])
  File &#34;/Users/akiyama/anaconda/lib/python2.7/site-packages/matplotlib/backends/__init__.py&#34;, line 16, in &lt;module&gt;
    line for line in traceback.format_stack()


  matplotlib.use(backend)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imaging Window: Specified. Images will be calcurated on specified pixels.
Imaging Window: Specified. Images will be calcurated on specified pixels.
Imaging Window: Not Specified. We calcurate the image on all the pixels.
Imaging Window: Not Specified. We calcurate the image on all the pixels.
Imaging Window: Not Specified. We calcurate the image on all the pixels.
Imaging Window: Not Specified. We calcurate the image on all the pixels.
</pre></div></div>
</div>
<p>You can also make such a plot by yourself. <strong>xxtable.eval_image</strong> or <strong>xxtable.residual_image</strong> can compute model or residual quantities of each data set.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">modelvis</span> <span class="o">=</span> <span class="n">vistable</span><span class="o">.</span><span class="n">eval_image</span><span class="p">(</span><span class="n">outimage</span><span class="p">)</span>
<span class="n">vistable</span><span class="o">.</span><span class="n">radplot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">modelvis</span><span class="o">.</span><span class="n">radplot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_examples_imaging_imaging_lbfgs_36_0.png" src="../../_images/_examples_imaging_imaging_lbfgs_36_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">regimage</span> <span class="o">=</span> <span class="n">outimage</span><span class="o">.</span><span class="n">convolve_gauss</span><span class="p">(</span><span class="n">majsize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">angunit</span><span class="o">=</span><span class="s2">&quot;mas&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hard_threshold</span><span class="p">(</span><span class="mf">0.10</span><span class="p">)</span>
<span class="n">regimage</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">regimage</span><span class="o">.</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">regimage</span><span class="o">.</span><span class="n">imshow</span><span class="p">()</span>
<span class="n">outimage</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.image.AxesImage at 0x1c2ec23bd0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_examples_imaging_imaging_lbfgs_37_1.png" src="../../_images/_examples_imaging_imaging_lbfgs_37_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">imprm</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;amptable&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">amptable</span> <span class="c1"># use amplitudes</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;bstable&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">bstable</span> <span class="c1"># use closure phases</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;catable&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">catable</span> <span class="c1"># use closure amplitudes</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;lambl1&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;lambtsv&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.5</span>
<span class="c1"># Cent-of-mass regularization</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;lambcom&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;compower&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">5.0</span> <span class="c1"># the power of the centroid. 1 gives the regularization using the exact center of the mass. The higher value gives regularization using the region close to the peak of the image.</span>
<span class="c1"># iteration number</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;niter&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">1000</span>
<span class="c1"># imaging window</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;imregion&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">imregion</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;reweight&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;reweight&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
    <span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;imregion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regimage</span>
    <span class="n">outimage</span> <span class="o">=</span> <span class="n">outimage</span><span class="o">.</span><span class="n">hard_threshold</span><span class="p">(</span><span class="mf">0.03</span><span class="p">)</span>
    <span class="n">outimage</span> <span class="o">=</span> <span class="n">imaging</span><span class="o">.</span><span class="n">lbfgs</span><span class="o">.</span><span class="n">imaging</span><span class="p">(</span><span class="n">outimage</span><span class="p">,</span><span class="o">**</span><span class="n">imprm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imaging Window: Specified. Images will be solved on specified pixels.
Total Flux Constraint: disabled.
Imaging Window: Specified. Images will be solved on specified pixels.
Total Flux Constraint: disabled.
Imaging Window: Specified. Images will be solved on specified pixels.
Total Flux Constraint: disabled.
Imaging Window: Specified. Images will be solved on specified pixels.
Total Flux Constraint: disabled.
Imaging Window: Specified. Images will be solved on specified pixels.
Total Flux Constraint: disabled.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">outimage</span><span class="o">.</span><span class="n">imshow</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.image.AxesImage at 0x1c35862bd0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_examples_imaging_imaging_lbfgs_40_1.png" src="../../_images/_examples_imaging_imaging_lbfgs_40_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">modelvis</span> <span class="o">=</span> <span class="n">catable</span><span class="o">.</span><span class="n">eval_image</span><span class="p">(</span><span class="n">outimage</span><span class="p">)</span>
<span class="n">catable</span><span class="o">.</span><span class="n">radplot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">modelvis</span><span class="o">.</span><span class="n">radplot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imaging Window: Not Specified. We calcurate the image on all the pixels.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_examples_imaging_imaging_lbfgs_41_1.png" src="../../_images/_examples_imaging_imaging_lbfgs_41_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">uvfits</span> <span class="o">=</span> <span class="n">uvdata</span><span class="o">.</span><span class="n">UVFITS</span><span class="p">(</span><span class="s2">&quot;./3C273DEC16.UVP&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">avspc</span><span class="p">()</span>
<span class="n">cltable</span> <span class="o">=</span> <span class="n">uvfits</span><span class="o">.</span><span class="n">selfcal</span><span class="p">(</span><span class="n">outimage</span><span class="p">)</span>
<span class="c1">#cltable = cltable.clear_amp() # for phase selfcal</span>
<span class="c1">#cltable = cltable.clear_phase()  # for amplitude selfcal</span>
<span class="n">uvfits2</span> <span class="o">=</span> <span class="n">uvfits</span><span class="o">.</span><span class="n">apply_cltable</span><span class="p">(</span><span class="n">cltable</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Filename: ./3C273DEC16.UVP
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 GroupsHDU      155   (3, 4, 1, 4, 1, 1)   float32   1913 Groups  7 Parameters
  1  AIPS NX       1 BinTableHDU     31   8R x 7C   [1E, 1E, 1J, 1J, 1J, 1J, 1J]
  2  AIPS FQ       1 BinTableHDU     29   1R x 6C   [1J, 4D, 4E, 4E, 4J, 32A]
  3  AIPS AN       1 BinTableHDU     72   10R x 14C   [8A, 3D, 0D, 1J, 1J, 1E, 1E, 4E, 1A, 1E, 8E, 1A, 1E, 8E]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
0it [00:00, ?it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Loading HDUs in the input UVFITS files.
  Primary HDU was loaded.
  AIPS FQ Table was loaded.
  Subarray 1 was found in an AIPS AN table

Checking loaded HDUs.
  1 Subarray settings are found.
  No AIPS SU tables were found.
    Assuming that this is a single source UVFITS file.

Reading FQ Tables
  Frequency Setup ID: 1
    IF Freq setups (Hz):
         if_freq_offset  ch_bandwidth  if_bandwidth  sideband
      0             0.0    64000000.0    64000000.0         1
      1      80000000.0    64000000.0    64000000.0         1
      2     144000000.0    64000000.0    64000000.0         1
      3     208000000.0    64000000.0    64000000.0         1
    Note: Central Frequency of ch=i at IF=j (where i,j=1,2,3...)
       freq(i,j) = reffreq + (i-1) * ch_bandwidth(j) * sideband + if_freq_offset(j)

Reading AN Tables
  Sub Array ID: 1
    Frequency Setup ID: 1
    Reference Frequency: 43007500000 Hz
    Reference Date: 2016-12-
    AN Table Contents:
         id      name             x             y             z  mnttype
      0   1  BR       -2.112065e+06 -3.705357e+06  4.726814e+06        0
      1   2  FD       -1.324009e+06 -5.332182e+06  3.231962e+06        0
      2   3  HN        1.446375e+06 -4.447940e+06  4.322306e+06        0
      3   4  KP       -1.995679e+06 -5.037318e+06  3.357328e+06        0
      4   5  LA       -1.449753e+06 -4.975299e+06  3.709124e+06        0
      5   6  MK       -5.464075e+06 -2.495248e+06  2.148297e+06        0
      6   7  NL       -1.308726e+05 -4.762317e+06  4.226851e+06        0
      7   8  OV       -2.409150e+06 -4.478573e+06  3.838617e+06        0
      8   9  PT       -1.640954e+06 -5.014816e+06  3.575412e+06        0
      9  10  SC        2.607849e+06 -5.488069e+06  1.932740e+06        0

Reading Source Information from Primary HDU
  Frequency Setup ID: 1
    Sources:
         id source                           radec  equinox
      0   1  3C273  12h29m06.6997s +02d03m08.5983s   2000.0

Reading Primary HDU data
  VisData.sort: 0 indexes have wrong station orders (ant1 &gt; ant2).
  VisData.sort: Data have been sorted by utc, ant1, ant2, subarray
Initialize CL Table
Compute Model Visibilities
Subarray 1
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
124it [00:01, 115.86it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">vtable</span> <span class="o">=</span> <span class="n">uvfits</span><span class="o">.</span><span class="n">select_stokes</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">make_vistable</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Stokes I data will be calculated from input RR and LL data
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">imprm</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;amptable&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">vistable</span> <span class="c1"># use amplitudes</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;bstable&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">bstable</span> <span class="c1"># use closure phases</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;catable&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">catable</span> <span class="c1"># use closure amplitudes</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;lambl1&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;lambtsv&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.5</span>
<span class="c1"># Total flux regularization</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;fluxconst&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;totalflux&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">12</span>
<span class="c1"># Cent-of-mass regularization</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;lambcom&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;compower&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">5.0</span> <span class="c1"># the power of the centroid. 1 gives the regularization using the exact center of the mass. The higher value gives regularization using the region close to the peak of the image.</span>
<span class="c1"># iteration number</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;niter&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">1000</span>
<span class="c1"># imaging window</span>
<span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;imregion&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">imregion</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;reweight&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;reweight&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
    <span class="n">imprm</span><span class="p">[</span><span class="s2">&quot;imregion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regimage</span>
    <span class="n">outimage</span> <span class="o">=</span> <span class="n">outimage</span><span class="o">.</span><span class="n">hard_threshold</span><span class="p">(</span><span class="mf">0.03</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">outimage</span> <span class="o">=</span> <span class="n">imaging</span><span class="o">.</span><span class="n">lbfgs</span><span class="o">.</span><span class="n">imaging</span><span class="p">(</span><span class="n">initimage</span><span class="p">,</span><span class="o">**</span><span class="n">imprm</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outimage</span> <span class="o">=</span> <span class="n">imaging</span><span class="o">.</span><span class="n">lbfgs</span><span class="o">.</span><span class="n">imaging</span><span class="p">(</span><span class="n">outimage</span><span class="p">,</span><span class="o">**</span><span class="n">imprm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Imaging Window: Specified. Images will be solved on specified pixels.
Total Flux Constraint: set to 12
Imaging Window: Specified. Images will be solved on specified pixels.
Total Flux Constraint: set to 12
Imaging Window: Specified. Images will be solved on specified pixels.
Total Flux Constraint: set to 12
Imaging Window: Specified. Images will be solved on specified pixels.
Total Flux Constraint: set to 12
Imaging Window: Specified. Images will be solved on specified pixels.
Total Flux Constraint: set to 12
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span><span class="n">outimage</span><span class="o">.</span><span class="n">imshow</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.image.AxesImage at 0x1c3673e890&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_examples_imaging_imaging_lbfgs_46_1.png" src="../../_images/_examples_imaging_imaging_lbfgs_46_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-, Smili Developper Team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>